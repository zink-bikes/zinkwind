{% comment %}
  Product section with blocks (TailwindUI styling)
  ---------------------------------------------------------
  Tab-based gallery on the left, modular content blocks on the right.
  The Add to Cart block wraps its own form, and other inputs link to it via the `form` attribute.
{% endcomment %}

<section class="bg-white color-scheme color-scheme--{{ section.settings.color_scheme }}">
  <div class="mx-auto max-w-2xl px-4 sm:px-6 sm:pt-16 lg:max-w-7xl lg:px-8">
    <div class="lg:grid lg:grid-cols-2 lg:gap-x-8 lg:items-start">
      <!-- Product Gallery -->
      <div class="w-full">
        {% render 'product-gallery', product: product, section_id: section.id %}
      </div>

      <!-- Product Info (Blocks) -->
      <div class="mt-10 px-4 sm:mt-16 sm:px-0 lg:mt-0">
        {% assign current_variant = product.selected_or_first_available_variant %}

      {% for block in section.blocks %}
        <div {{ block.shopify_attributes }}>
          {% case block.type %}

            {% when 'title' %}
              {% if product.title != blank %}
                <h1 class="text-3xl font-bold tracking-tight text-gray-900">{{ product.title }}</h1>
              {% endif %}

            {% when 'price' %}
              {% if product.price != blank %}
                <div class="mt-3" data-product-form="{{ section.id }}">
                  <h2 class="sr-only">Product information</h2>
                  <p class="text-3xl tracking-tight text-gray-900">
                    <span data-product-price>{{ current_variant.price | money }}</span>
                  </p>
                  {% if current_variant.compare_at_price > current_variant.price %}
                    <p class="mt-1 text-base text-gray-500 line-through" data-compare-price>
                      {{ current_variant.compare_at_price | money }}
                    </p>
                  {% else %}
                    <p class="mt-1 text-base text-gray-500 line-through hidden" data-compare-price></p>
                  {% endif %}
                </div>
              {% endif %}

            {% when 'description' %}
              {% if product.description != blank %}
                <div class="mt-6">
                  <h3 class="sr-only">Description</h3>
                  {% if block.settings.read_more %}
                    {% render 'read-more', content: product.description, classes: 'text-base text-gray-700' %}
                  {% else %}
                    <div class="text-base text-gray-700 space-y-6">{{ product.description }}</div>
                  {% endif %}
                </div>
              {% endif %}

            {% when 'vendor' %}
              {% if product.vendor != blank %}
                <p class="text-sm text-gray-500">Brand: <span class="font-medium text-gray-900">{{ product.vendor }}</span></p>
              {% endif %}

            {% when 'divider' %}
              <hr class="my-6 border-t border-gray-200">

            {% when 'variant_selector' %}
              {% render 'variant-selector', product: product, section_id: section.id %}

            {% when 'add_to_cart' %}
              {% form 'product', product, id: 'ProductForm-{{ section.id }}', data-cart-form: true, data-product-form: section.id %}
                <div class="mt-10 flex flex-col gap-3">
                  <button
                    type="submit"
                    class="flex w-full items-center justify-center rounded-md border border-transparent bg-indigo-600 px-8 py-3 text-base font-medium text-white hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed"
                    data-cart-submit
                    data-text-available="Add to cart"
                    data-text-sold-out="Sold out"
                  >
                    Add to cart
                  </button>
                  <input
                    type="hidden"
                    name="id"
                    value="{{ product.selected_or_first_available_variant.id }}"
                    data-variant-id
                  />

                  {% if block.settings.show_dynamic_checkout %}
                    {{ form | payment_button }}
                  {% endif %}
                </div>
              {% endform %}

            {% when 'quantity' %}
              <div class="mt-6">
                <label
                  for="Quantity-{{ section.id }}"
                  class="block text-sm font-medium text-gray-700 mb-2"
                >
                  Quantity
                </label>
                <div class="flex items-center border border-gray-300 rounded-md w-32">
                  <button
                    type="button"
                    class="px-3 py-2 text-gray-600 hover:text-gray-900 focus:outline-none"
                    onclick="this.nextElementSibling.stepDown()"
                  >
                    âˆ’
                  </button>
                  <input
                    type="number"
                    name="quantity"
                    form="ProductForm-{{ section.id }}"
                    id="Quantity-{{ section.id }}"
                    min="1"
                    value="1"
                    class="w-full text-center border-0 focus:ring-0 text-gray-900"
                  >
                  <button
                    type="button"
                    class="px-3 py-2 text-gray-600 hover:text-gray-900 focus:outline-none"
                    onclick="this.previousElementSibling.stepUp()"
                  >
                    +
                  </button>
                </div>
              </div>

            {% when 'custom_text' %}
              {% if block.settings.text != blank %}
                <p>{{ block.settings.text }}</p>
              {% endif %}

          {% endcase %}
        </div>
      {% endfor %}
    </div>
  </div>
</div>
</section>


{% schema %}
{
  "name": "Product (Tailwind Blocks)",
  "settings": [
    {
      "type": "header",
      "content": "Color scheme"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color scheme"
    }
  ],
  "blocks": [
    { "type": "title", "name": "Product Title" },
    { "type": "price", "name": "Product Price" },
    {
      "type": "description",
      "name": "Product Description",
      "settings": [
        { "type": "checkbox", "id": "read_more", "label": "Show as read more ", "default": true }
      ]
    },
    { "type": "variant_selector", "name": "Variant Selector" },
    { "type": "quantity", "name": "Quantity Input" },
    { "type": "divider", "name": "Divider" },
    { "type": "vendor", "name": "Product Vendor" },
    {
      "type": "add_to_cart",
      "name": "Add to Cart Button",
      "settings": [
        {
          "type": "checkbox",
          "id": "show_dynamic_checkout",
          "label": "Show dynamic checkout button",
          "default": true
        }
      ]
    },
    {
      "type": "custom_text",
      "name": "Custom Text",
      "settings": [
        {
          "type": "text",
          "id": "text",
          "label": "Text",
          "default": "Example custom text block."
        }
      ]
    }
  ],
  "max_blocks": 15,
  "disabled_on": { "groups": ["header", "footer"] },
  "presets": [
    {
      "name": "Product page",
      "blocks": [
        { "type": "title" },
        { "type": "price" },
        { "type": "description" },
        { "type": "variant_selector" },
        { "type": "quantity" },
        { "type": "add_to_cart" }
      ]
    }
  ]
}
{% endschema %}
