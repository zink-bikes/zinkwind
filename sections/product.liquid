{% comment %}
  Product section with blocks (Tailwind-only)
  ---------------------------------------------------------
  Static gallery on the left, modular content blocks on the right.
  The Add to Cart block wraps its own form, and other inputs link to it via the `form` attribute.
{% endcomment %}

<section class="color-scheme color-scheme--{{ section.settings.color_scheme }}">
  <div class="flex flex-row flex-wrap gap-10 md:flex-nowrap page-width p-default">
    <!-- Static Product Gallery -->
    <div class="w-full md:w-2/3">
      {% render 'product-gallery', product: product %}
    </div>

    <!-- Product Info (Blocks) -->
    <div class="flex flex-col w-full gap-3 md:w-1/3">
      {% assign current_variant = product.selected_or_first_available_variant %}

      {% for block in section.blocks %}
        <div {{ block.shopify_attributes }}>
          {% case block.type %}

            {% when 'title' %}
              {% if product.title != blank %}
                <h1 class="h2">{{ product.title }}</h1>
              {% endif %}

            {% when 'price' %}
              {% if product.price != blank %}
                <div data-product-form="{{ section.id }}">
                  <span class="text-base font-medium">
                    <span data-product-price>{{ current_variant.price | money }}</span>
                    {% if current_variant.compare_at_price > current_variant.price %}
                      <span class="ml-2 text-sm text-(--color-accent) line-through" data-compare-price>
                        {{ current_variant.compare_at_price | money }}
                      </span>
                    {% else %}
                      <span class="ml-2 text-sm text-(--color-accent) line-through hidden" data-compare-price></span>
                    {% endif %}
                  </span>
                </div>
              {% endif %}

            {% when 'description' %}
              {% if product.description != blank %}
                {% if block.settings.read_more %}
                  {% render 'read-more', content: product.description, classes: '' %}
                {% else %}
                  <div>{{ product.description }}</div>
                {% endif %}
              {% endif %}

            {% when 'vendor' %}
              {% if product.vendor != blank %}
                <span class="text-sm text-(--color-accent)">{{ product.vendor }}</span>
              {% endif %}

            {% when 'divider' %}
              <hr class="border-t border-(--color-accent)">

            {% when 'variant_selector' %}
              {% render 'variant-selector', product: product, section_id: section.id %}

            {% when 'add_to_cart' %}
              {% form 'product', product, id: 'ProductForm-{{ section.id }}', data-cart-form: true, data-product-form: section.id %}
                <div class="flex flex-col gap-2">
                  <input
                    type="submit"
                    value="Add to cart"
                    class="button-primary"
                    data-cart-submit
                    data-text-available="Add to cart"
                    data-text-sold-out="Sold out"
                  >
                  <input
                    type="hidden"
                    name="id"
                    value="{{ product.selected_or_first_available_variant.id }}"
                    data-variant-id
                  />

                  {% if block.settings.show_dynamic_checkout %}
                    {{ form | payment_button }}
                  {% endif %}
                </div>
              {% endform %}

            {% when 'quantity' %}
              <div class="flex flex-col gap-1">
                <label
                  for="Quantity-{{ section.id }}"
                  class="underline"
                >
                  Quantity
                </label>
                <div class="flex items-center justify-between border">
                  <button
                    type="button"
                    class="px-3 py-2 button-secondary"
                    onclick="this.nextElementSibling.stepDown()"
                  >
                    âˆ’
                  </button>
                  <input
                    type="number"
                    name="quantity"
                    form="ProductForm-{{ section.id }}"
                    id="Quantity-{{ section.id }}"
                    min="1"
                    value="1"
                    class="text-center"
                  >
                  <button
                    type="button"
                    class="px-3 py-2 button-secondary"
                    onclick="this.previousElementSibling.stepUp()"
                  >
                    +
                  </button>
                </div>
              </div>

            {% when 'custom_text' %}
              {% if block.settings.text != blank %}
                <p>{{ block.settings.text }}</p>
              {% endif %}

          {% endcase %}
        </div>
      {% endfor %}
    </div>
  </div>
</section>


{% schema %}
{
  "name": "Product (Tailwind Blocks)",
  "settings": [
    {
      "type": "header",
      "content": "Color scheme"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color scheme"
    }
  ],
  "blocks": [
    { "type": "title", "name": "Product Title" },
    { "type": "price", "name": "Product Price" },
    {
      "type": "description",
      "name": "Product Description",
      "settings": [
        { "type": "checkbox", "id": "read_more", "label": "Show as read more ", "default": true }
      ]
    },
    { "type": "variant_selector", "name": "Variant Selector" },
    { "type": "quantity", "name": "Quantity Input" },
    { "type": "divider", "name": "Divider" },
    { "type": "vendor", "name": "Product Vendor" },
    {
      "type": "add_to_cart",
      "name": "Add to Cart Button",
      "settings": [
        {
          "type": "checkbox",
          "id": "show_dynamic_checkout",
          "label": "Show dynamic checkout button",
          "default": true
        }
      ]
    },
    {
      "type": "custom_text",
      "name": "Custom Text",
      "settings": [
        {
          "type": "text",
          "id": "text",
          "label": "Text",
          "default": "Example custom text block."
        }
      ]
    }
  ],
  "max_blocks": 15,
  "disabled_on": { "groups": ["header", "footer"] },
  "presets": [
    {
      "name": "Product page",
      "blocks": [
        { "type": "title" },
        { "type": "price" },
        { "type": "description" },
        { "type": "variant_selector" },
        { "type": "quantity" },
        { "type": "add_to_cart" }
      ]
    }
  ]
}
{% endschema %}
